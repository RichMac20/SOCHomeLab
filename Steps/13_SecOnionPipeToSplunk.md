# Setup Splunk HEC (Splunk): 
- Create new Ingestion:
  - In Splunk Enterprise:
    - Settings > New Data > Monitor > HTTP Event Collector:
    - Name the Collector
    - Next
    - Select Create a new Index (seconion_hec)
    - Review and finish 
- Make sure SSL is on for HEC
  - Settings > Data Inputs > HEC > Global Settings > Check SSL box
  ---
  <img width="561" height="293"  alt="download" src="https://github.com/user-attachments/assets/18c1f6a6-ac36-4fb5-878e-aba91756b2e1" />
# Setup Filebeat on Security Onion:
- Configure Filebeat to Forward logs via Syslog to Splunk:
  - Filebeat: Tool used to forward specific logs to a destination, like splunk. (Not typically installed)
- In Security Onion:
  - Install Filebeat:
    - Enter ‘curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-9.0.0-x86_64.rpm’
      - Downloads official filebeat package
  - Enter ‘sudo rpm -i filebeat-9.0.0-x86_64.rpm’
    - Installs Filebeat via rpm package
  - Enter ‘sudo systemctl start filebeat’
    - Starts filebeat
  - Enter ‘sudo systemctl enable filebeat’ 
    - Enables Filebeat to start on boot
  - Enter ‘sudo systemctl status filebeat’ 
    - Look for ‘Running’ to confirm its on
  - Next, change the //etc/filebeat/filebeat.yml (Config File) to forward Zeek, Suricata and Wazuh logs.
    - Zeek: Network security monitoring tool that analyzes network traffic in real-time
      - Collects: Network session logs (HTTP, DNS, SSL, FTP, etc…)
      - Network connection metadata
      - Protocol-specific events and suspicious behaviors
      - Detects anomalies, scans, and traffic patterns
    - Suricata: Network intrusion detection and prevention system that inspects network packets for signatures and anomalies
      - Collects: Alerts triggered by known signatures
      - Network flow data/metadata
      - Protocol anomalies, suspicious packet payloads 
    - Wazuh: Host based intrusion detection system that monitors endpoints for security events
      - Collects: Host logs
      - Security alerts
      - Configuration changes
      - OSSEC-based rules for threat detection 
      - Rules maintained by OSSEC/Wazuh Devs and local administrators.
  - Copy the [filebeat.yml](https://github.com/RichMac20/SOCHomeLab/blob/main/Steps/Configs/filebeat.yml) file into //etc/filebeat/filebeat.yml and //etc/logstash/conf.d/(filename)** respectively 
- Restart filebeat:
  - Enter ‘sudo systemctl restart filebeat’ 
# Setup Logstash for Security Onion:
- Add Elastic repo (Holds Logstash and other tools) 
  - Add the following into a shell script
    - #!/bin/bash
    - sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
    - cat <<EOF | sudo tee /etc/yum.repos.d/elastic.repo
    - [elastic-8.x]
    - name=Elastic repository for 8.x packages
    - baseurl=https://artifacts.elastic.co/packages/8.x/yum
    - gpgcheck=1
    - gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
    - enabled=1
    - autorefresh=1
    - type=rpm-md
    - EOF
    - sudo yum clean all
    - Run the script
- Install Logstash 
  - “sudo yum install logstash”
- Start and enable Logstash on boot:
  - “sudo systemctl start logstash”
  - “sudo systemctl enable logstash”
- Next create a docker container with a custom docker image of Logstash with the splunk_hec plugin added
  - “docker pull docker.elastic.co/logstash/logstash:8.18.2”
    - Pulls the official image
- Create a Dockerfile in /root/logstash-docker/ named Dockerfile 
  - Will be used to build customer docker image with splunk_hec
    - “FROM docker.elastic.co/logstash/logstash:8.18.2”
    - “RUN logstash-plugin install logstash-output-splunk_hec”
- Build custom Logstash container image
  - “Docker build -t custom-logstash:latest .”
- Create a ‘Config’ Folder in /root/logstash-docker/ 
- Create a file in the Config folder titled logstash.yml
  - “Xpack.monitoring.enabled: false”
  - Disabled Licensereader/checker
    - If not disabled it will try and check the license in elasticsearch which hasn’t been setup. 
- Create a [logstash.conf](https://github.com/RichMac20/SOCHomeLab/blob/main/Steps/Configs/logstash.conf) file in /root/logstash-docker/pipeline/
- Run the following command as one: (Only run after logstash.conf is created)
  - “docker run -d --name logstash --restart unless-stopped -v /root/logstash-docker/pipeline:/usr/share/logstash/pipeline -v /root/logstash-docker/config/logstash.yml:/usr/share/logstash/config/logstash.yml -p 5044:5044 custom-logstash:latest logstash -f /usr/share/logstash/pipeline/logstash.conf
  - Command creates a docker container titled ‘logstash’ and boots on start unless stopped. Creates a logstash.conf file in /usr/share/logstash/pipeline within the container to use the conf and uses the logstash.yml file to disable lisensereader/checker (only works in .yml). Uses port 5044 and the custom-logstash image we created earlier. Final command just forces the use of the logstash.conf file.  
- Check Splunk HEC (seconion_hec)
  - Should be receiving logs now. 
